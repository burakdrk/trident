import Foundation

struct Emote: Identifiable, Hashable, Sendable {
  enum Category: String, Sendable {
    case global = "Global"
    case channel = "Channel"
    case unknown
  }

  enum Source: String, Sendable {
    case twitch = "https://static-cdn.jtvnw.net/emoticons/v2/"
    case bttv = "https://cdn.betterttv.net/emote/"
    case ffz = "https://cdn.frankerfacez.com/emote/"
    case seventv = "https://cdn.7tv.app/emote/"
  }

  let name: String
  let id: String
  let category: Category
  let source: Source
  let overlay: Bool
  var width = 28
  var height = 28

  var url: URL {
    switch source {
    case .bttv:
      guard let url = URL(string: "\(source.rawValue)\(id)/2x.webp") else {
        fatalError("Invalid BTTV URL")
      }
      return url
    case .ffz:
      guard let url = URL(string: "\(source.rawValue)\(id)/2") else {
        fatalError("Invalid FFZ URL")
      }
      return url
    case .seventv:
      guard let url = URL(string: "\(source.rawValue)\(id)/2x.webp") else {
        fatalError("Invalid 7TV URL")
      }
      return url
    case .twitch:
      guard let url = URL(string: "\(source.rawValue)\(id)/default/dark/2.0") else {
        fatalError("Invalid Twitch URL")
      }
      return url
    }
  }

  func size(
    multiplier: CGFloat = 1.0
  ) -> CGSize {
    var w = width
    var h = height
    if source == .twitch {
      (w, h) = Emote.twitchOutliers[id] ?? (width, height)
    }

    let multiplier = multiplier * 1.25 // Baseline multiplier for better visibility
    return CGSize(width: CGFloat(w) * multiplier, height: CGFloat(h) * multiplier)
  }

  static func == (lhs: Emote, rhs: Emote) -> Bool {
    lhs.id == rhs.id && lhs.source == rhs.source
  }
}

// MARK: - Mock Data

extension Emote {
  static var mockOverlay: Emote {
    .init(
      name: "RainTime",
      id: "01FCY771D800007PQ2DF3GDTN6",
      category: .global,
      source: .seventv,
      overlay: true,
      width: 32,
      height: 32
    )
  }

  static var mock7tv: Emote {
    .init(
      name: "sadEing",
      id: "01J3Q6RTN80004SVBK6PNC1AA8",
      category: .channel,
      source: .seventv,
      overlay: false,
      width: 32,
      height: 32
    )
  }

  static var mocks: [Emote] {
    [.mockOverlay, .mock7tv]
  }
}

// MARK: - Outliers

extension Emote {
  /// Maps ID to w,h
  static let twitchOutliers = [
    "555555635": (21, 18), /* ;p */
    "555555636": (21, 18), /* ;-p */
    "555555614": (21, 18), /* O_o */
    "555555641": (21, 18), /* :z */
    "555555604": (21, 18), /* :\\ */
    "444": (21, 18), /* :| */
    "555555634": (21, 18), /* ;-P */
    "439": (21, 18), /* ;) */
    "555555642": (21, 18), /* :-z */
    "555555613": (21, 18), /* :-o */
    "555555625": (21, 18), /* :-p */
    "433": (21, 18), /* :/ */
    "555555622": (21, 18), /* :P */
    "555555640": (21, 18), /* :-| */
    "555555623": (21, 18), /* :-P */
    "555555628": (21, 18), /* :) */
    "555555632": (21, 18), /* 8-) */
    "555555667": (20, 18), /* ;p */
    "445": (21, 18), /* <3 */
    "555555668": (20, 18), /* ;-p */
    "555555679": (20, 18), /* :z */
    "483": (20, 18), /* <3 */
    "555555666": (20, 18), /* ;-P */
    "497": (20, 18), /* O_o */
    "555555664": (20, 18), /* :-p */
    "555555671": (20, 18), /* :o */
    "555555681": (20, 18), /* :Z */
    "555555672": (20, 18), /* :-o */
    "555555676": (20, 18), /* :-\\ */
    "555555611": (21, 18), /* :-O */
    "555555670": (20, 18), /* :-O */
    "555555688": (20, 18), /* :-D */
    "441": (21, 18), /* B) */
    "555555601": (21, 18), /* >( */
    "491": (20, 18), /* ;P */
    "496": (20, 18), /* :D */
    "492": (20, 18), /* :O */
    "555555573": (24, 18), /* o_O */
    "555555643": (21, 18), /* :Z */
    "1898": (26, 28), /* ThunBeast */
    "555555682": (20, 18), /* :-Z */
    "1896": (20, 30), /* WholeWheat */
    "1906": (24, 30), /* SoBayed */
    "555555607": (21, 18), /* :-( */
    "555555660": (20, 18), /* :-( */
    "489": (20, 18), /* :( */
    "495": (20, 18), /* :s */
    "555555638": (21, 18), /* :-D */
    "357": (28, 30), /* HotPokket */
    "555555624": (21, 18), /* :p */
    "73": (21, 30), /* DBstyle */
    "555555674": (20, 18), /* :-/ */
    "555555629": (21, 18), /* :-) */
    "555555600": (24, 18), /* R-) */
    "41": (19, 27), /* Kreygasm */
    "555555612": (21, 18), /* :o */
    "488": (29, 24), /* :7 */
    "69": (41, 28), /* BloodTrail */
    "555555608": (21, 18), /* R) */
    "501": (20, 18), /* ;) */
    "50": (18, 27), /* ArsonNoSexy */
    "443": (21, 18), /* :D */
    "1904": (24, 30), /* BigBrother */
    "555555595": (24, 18), /* ;P */
    "555555663": (20, 18), /* :p */
    "555555576": (24, 18), /* o.o */
    "360": (22, 30), /* FailFish */
    "500": (20, 18), /* B) */
    "3": (24, 18), /* :D */
    "484": (20, 22), /* R) */
    "555555678": (20, 18), /* :-| */
    "7": (24, 18), /* B) */
    "52": (32, 32), /* SMOrc */
    "555555644": (21, 18), /* :-Z */
    "18": (20, 27), /* TheRinger */
    "49106": (27, 28), /* CorgiDerp */
    "6": (24, 18), /* O_o */
    "10": (24, 18), /* :/ */
    "47": (24, 24), /* PunchTrees */
    "555555561": (24, 18), /* :-D */
    "555555564": (24, 18), /* :-| */
    "13": (24, 18), /* ;P */
    "555555593": (24, 18), /* :p */
    "555555589": (24, 18), /* ;) */
    "555555590": (24, 18), /* ;-) */
    "486": (27, 42), /* :> */
    "40": (21, 27), /* KevinTurtle */
    "555555558": (24, 18), /* :( */
    "555555597": (24, 18), /* ;p */
    "555555580": (24, 18), /* :O */
    "555555567": (24, 18), /* :Z */
    "1": (24, 18), /* :) */
    "11": (24, 18), /* ;) */
    "33": (25, 32), /* DansGame */
    "555555586": (24, 18), /* :-/ */
    "4": (24, 18), /* >( */
    "555555588": (24, 18), /* :-\\ */
    "12": (24, 18), /* :P */
    "555555563": (24, 18), /* :| */
    "555555581": (24, 18), /* :-O */
    "555555598": (24, 18), /* ;-p */
    "555555596": (24, 18), /* ;-P */
    "555555557": (24, 18), /* :-) */
    "498": (20, 18), /* >( */
    "555555680": (20, 18), /* :-z */
    "555555587": (24, 18), /* :\\ */
    "5": (24, 18), /* :| */
    "354": (20, 30), /* 4Head */
    "555555562": (24, 18), /* >( */
    "555555594": (24, 18), /* :-p */
    "490": (20, 18), /* :P */
    "555555662": (20, 18), /* :-P */
    "2": (24, 18), /* :( */
    "1902": (27, 29), /* Keepo */
    "555555627": (21, 18), /* ;-) */
    "555555566": (24, 18), /* :-z */
    "555555559": (24, 18), /* :-( */
    "555555592": (24, 18), /* :-P */
    "28": (39, 27), /* MrDestructoid */
    "8": (24, 18), /* :O */
    "244": (24, 30), /* FUNgineer */
    "555555591": (24, 18), /* :P */
    "555555585": (24, 18), /* :/ */
    "494": (20, 18), /* :| */
    "9": (24, 18), /* <3 */
    "555555584": (24, 18), /* <3 */
    "555555579": (24, 18), /* 8-) */
    "14": (24, 18), /* R) */
    "485": (27, 18), /* #/ */
    "555555560": (24, 18), /* :D */
    "86": (36, 30), /* BibleThump */
    "555555578": (24, 18), /* B-) */
    "17": (20, 27), /* StoneLightning */
    "436": (21, 18), /* :O */
    "555555675": (20, 18), /* :\\ */
    "22": (19, 27), /* RedCoat */
    "555555574": (24, 18), /* o.O */
    "555555603": (21, 18), /* :-/ */
    "1901": (24, 28), /* Kippa */
    "15": (21, 27), /* JKanStyle */
    "555555605": (21, 18), /* :-\\ */
    "555555701": (20, 18), /* ;-) */
    "487": (20, 42), /* <] */
    "555555572": (24, 18), /* O.O */
    "65": (40, 30), /* FrankerZ */
    "25": (25, 28), /* Kappa */
    "36": (36, 30), /* PJSalt */
    "499": (20, 18), /* :) */
    "555555565": (24, 18), /* :z */
    "434": (21, 18), /* :( */
    "555555577": (24, 18), /* B) */
    "34": (21, 28), /* SwiftRage */
    "555555575": (24, 18), /* o_o */
    "92": (23, 30), /* PMSTwin */
    "555555570": (24, 18), /* O.o */
    "555555569": (24, 18), /* O_o */
    "493": (20, 18), /* :/ */
    "26": (20, 27), /* JonCarnage */
    "66": (20, 27), /* OneHand */
    "555555568": (24, 18), /* :-Z */
    "555555599": (24, 18), /* R) */
    "1900": (33, 30), /* RalpherZ */
    "555555582": (24, 18), /* :o */
    "1899": (22, 30), /* TF2John */
    "555555633": (21, 18), /* ;P */
    "16": (22, 27), /* OptimizePrime */
    "30": (29, 27), /* BCWarrior */
    "555555583": (24, 18), /* :-o */
    "32": (21, 27), /* GingerPower */
    "87": (24, 30), /* ShazBotstix */
    "74": (24, 30), /* AsianGlow */
    "555555571": (24, 18), /* O_O */
    "46": (24, 24) /* SSSsss */
  ]
}
